syntax = "proto3";

package com.malinskiy.marathon.vendor.junit4.booter.contract;

import "google/protobuf/empty.proto";

option java_multiple_files = true;
option java_package = "com.malinskiy.marathon.vendor.junit4.booter.contract";

enum EventType {
    RUN_STARTED = 0;
    RUN_FINISHED = 1;
    TEST_STARTED = 2;
    TEST_FINISHED = 3;
    TEST_FAILURE = 4;
    TEST_ASSUMPTION_FAILURE = 5;
    TEST_IGNORED = 6;
}

message TestEvent {
    EventType eventType = 1;
    sint32 testCount = 2;
    sint64 totalDurationMillis = 3;
    string classname = 4;
    string method = 5;
    string message = 6;
    string stacktrace = 7;
}

message TestRequest {
    repeated TestDescription testDescription = 1;
    TestEnvironment testEnvironment = 2;
}

message TestEnvironment {
    repeated string classpath = 1;
    string javaHome = 2;
    repeated string javaOptions = 3;
    string workdir = 4;
}

message TestDescription {
    string fqtn = 1;
    string description = 2;
}

service TestExecutor {
    rpc execute(TestRequest) returns (stream TestEvent);
    rpc terminate(google.protobuf.Empty) returns (google.protobuf.Empty);
}
